# Generated from:
# https://github.com/zopefoundation/meta/tree/master/config/pure-python
[meta]
template = "pure-python"
commit-id = "e50f4025944ffabd7c3318554c36d0dc24b71241"

[python]
with-appveyor = true
with-pypy = false
with-legacy-python = true
with-docs = true
with-sphinx-doctests = true

[tox]
use-flake8 = true
additional-envlist = [
    "py36-datetime",
    "combined-coverage",
    ]
testenv-deps = [
    "datetime: DateTime",
    "-cconstraints.txt",
    "pytest-cov",
    "coverage-python-version",
    ]
testenv-setenv = [
    "COVERAGE_FILE=.coverage.{envname}",
    ]
testenv-commands = [
    "python -V",
    "pip list",
    "pytest --cov=src --cov=tests --cov-report= {posargs}",
    ]
testenv-additional = [
    "",
    "[testenv:combined-coverage]",
    "basepython = python3",
    "allowlist_externals =",
    "    mkdir",
    "deps =",
    "    coverage",
    "    coverage-python-version",
    "    # Until repoze.sphinx.autointerface supports Sphinx 4.x we cannot use it:",
    "    Sphinx < 4",
    "    -cconstraints.txt",
    "setenv =",
    "    COVERAGE_FILE=.coverage",
    "commands =",
    "    mkdir -p {toxinidir}/parts/htmlcov",
    "    coverage combine",
    "    coverage html",
    "    coverage report -m --fail-under=100",
    "depends = py27,py35,py36,py36-datetime,py37,py38,py39,coverage",
    ]
coverage-basepython = "python3.8"
coverage-command = "pytest --cov=src --cov=tests --cov-report= {posargs}"

[coverage]
fail-under = 99.2

[manifest]
additional-rules = [
    "recursive-include docs *.ast",
    "recursive-include docs *.bat",
    "recursive-include docs *.jpg",
    "recursive-include tests *.py",
    ]

[check-manifest]
additional-ignores = [
    "docs/CHANGES.rst",
    "docs/_build/html/_images/*",
    "docs/_build/html/_sources/contributing/*",
    "docs/_build/html/_sources/install/*",
    "docs/_build/html/_sources/roadmap/*",
    "docs/_build/html/_sources/upgrade_dependencies/*",
    "docs/_build/html/_sources/usage/*",
    ]

[github-actions]
additional-config = [
    "- [\"3.6\",   \"py36-datetime\"]",
    ]

[appveyor]
replacement = [
    "# AppVeyor CI settings (Windows Machine CI Tests)",
    "environment:",
    "  matrix:",
    "    - PROFILE: py27",
    "      PYTHON_VERSION: \"2.7\"",
    "      TOXENV: \"py27\"",
    "    - PROFILE: py35",
    "      PYTHON_VERSION: \"3.5\"",
    "      TOXENV: \"py35\"",
    "    - PROFILE: py36",
    "      PYTHON_VERSION: \"3.6\"",
    "      TOXENV: \"py36,py36-datetime\"",
    "    - PROFILE: py37",
    "      PYTHON_VERSION: \"3.7\"",
    "      TOXENV: \"py37\"",
    "    - PROFILE: py38",
    "      PYTHON_VERSION: \"3.8\"",
    "      TOXENV: \"py38\"",
    "    - PROFILE: py39",
    "      PYTHON_VERSION: \"3.9\"",
    "      TOXENV: \"py39\"",
    "cache:",
    "  - '%LOCALAPPDATA%\\pip\\Cache'",
    "version: '{branch}.{build}'",
    "build: off",
    "install:",
    "  - pip install tox",
    "test_script:",
    "  - python -V",
    "  - tox",
    ]
